<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #222222 }
body  { background: #000000; color: #cccccc }
body .c { color: #000080 } /* Comment */
body .err { color: #cccccc; border: 1px solid #FF0000 } /* Error */
body .esc { color: #cccccc } /* Escape */
body .g { color: #cccccc } /* Generic */
body .k { color: #cdcd00 } /* Keyword */
body .l { color: #cccccc } /* Literal */
body .n { color: #cccccc } /* Name */
body .o { color: #3399cc } /* Operator */
body .x { color: #cccccc } /* Other */
body .p { color: #cccccc } /* Punctuation */
body .cm { color: #000080 } /* Comment.Multiline */
body .cp { color: #000080 } /* Comment.Preproc */
body .c1 { color: #000080 } /* Comment.Single */
body .cs { color: #cd0000; font-weight: bold } /* Comment.Special */
body .gd { color: #cd0000 } /* Generic.Deleted */
body .ge { color: #cccccc; font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00cd00 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { color: #cccccc; font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #cdcd00 } /* Keyword.Constant */
body .kd { color: #00cd00 } /* Keyword.Declaration */
body .kn { color: #cd00cd } /* Keyword.Namespace */
body .kp { color: #cdcd00 } /* Keyword.Pseudo */
body .kr { color: #cdcd00 } /* Keyword.Reserved */
body .kt { color: #00cd00 } /* Keyword.Type */
body .ld { color: #cccccc } /* Literal.Date */
body .m { color: #cd00cd } /* Literal.Number */
body .s { color: #cd0000 } /* Literal.String */
body .na { color: #cccccc } /* Name.Attribute */
body .nb { color: #cd00cd } /* Name.Builtin */
body .nc { color: #00cdcd } /* Name.Class */
body .no { color: #cccccc } /* Name.Constant */
body .nd { color: #cccccc } /* Name.Decorator */
body .ni { color: #cccccc } /* Name.Entity */
body .ne { color: #666699; font-weight: bold } /* Name.Exception */
body .nf { color: #cccccc } /* Name.Function */
body .nl { color: #cccccc } /* Name.Label */
body .nn { color: #cccccc } /* Name.Namespace */
body .nx { color: #cccccc } /* Name.Other */
body .py { color: #cccccc } /* Name.Property */
body .nt { color: #cccccc } /* Name.Tag */
body .nv { color: #00cdcd } /* Name.Variable */
body .ow { color: #cdcd00 } /* Operator.Word */
body .w { color: #cccccc } /* Text.Whitespace */
body .mb { color: #cd00cd } /* Literal.Number.Bin */
body .mf { color: #cd00cd } /* Literal.Number.Float */
body .mh { color: #cd00cd } /* Literal.Number.Hex */
body .mi { color: #cd00cd } /* Literal.Number.Integer */
body .mo { color: #cd00cd } /* Literal.Number.Oct */
body .sb { color: #cd0000 } /* Literal.String.Backtick */
body .sc { color: #cd0000 } /* Literal.String.Char */
body .sd { color: #cd0000 } /* Literal.String.Doc */
body .s2 { color: #cd0000 } /* Literal.String.Double */
body .se { color: #cd0000 } /* Literal.String.Escape */
body .sh { color: #cd0000 } /* Literal.String.Heredoc */
body .si { color: #cd0000 } /* Literal.String.Interpol */
body .sx { color: #cd0000 } /* Literal.String.Other */
body .sr { color: #cd0000 } /* Literal.String.Regex */
body .s1 { color: #cd0000 } /* Literal.String.Single */
body .ss { color: #cd0000 } /* Literal.String.Symbol */
body .bp { color: #cd00cd } /* Name.Builtin.Pseudo */
body .vc { color: #00cdcd } /* Name.Variable.Class */
body .vg { color: #00cdcd } /* Name.Variable.Global */
body .vi { color: #00cdcd } /* Name.Variable.Instance */
body .il { color: #cd00cd } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span class="kn">from</span> <span class="nn">Tkinter</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">mimetypes</span>

<span class="k">class</span> <span class="nc">AreaVi</span><span class="p">(</span><span class="n">Text</span><span class="p">):</span>
    <span class="n">ACTIVE</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class receives all Text widget arguments</span>
<span class="sd">        and one named default_filename which means</span>
<span class="sd">        the filename that is saved when no filename</span>
<span class="sd">        is specified.</span>

<span class="sd">        default_filename:   </span>
<span class="sd">        The default path file where contents are saved.        </span>

<span class="sd">        It implements a system of modes to handle</span>
<span class="sd">        tkinter keypresses events. </span>
<span class="sd">        </span>
<span class="sd">        The method hook can be used to bind events</span>
<span class="sd">        to callbacks mapped to specific modes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Text</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c"># Maybe it should be?</span>
        <span class="c"># abspath(default_filename)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_filename</span> <span class="o">=</span> <span class="n">default_filename</span>

        <span class="c"># The file&#39;s path and name.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">default_filename</span>

        <span class="c"># Shouldn&#39;t it be LAST_COL and MSEL?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_col</span> <span class="o">=</span> <span class="s">&#39;_last_col_&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_col</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">)</span>

        <span class="c"># This mark is used in AreaVi.replace_all.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">STOP_REPLACE_INDEX</span> <span class="o">=</span> <span class="s">&#39;_stop_replace_index_&#39;</span>
        <span class="c"># Tags have name starting and ending with __</span>


        <span class="c"># def cave(event):</span>
            <span class="c"># AreaVi.ACTIVE = event.widget</span>
        <span class="c"># self.hook(-1, &#39;&lt;FocusIn&gt;&#39;, cave)</span>
        <span class="n">AreaVi</span><span class="o">.</span><span class="n">ACTIVE</span>        <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charset</span>         <span class="o">=</span> <span class="s">&#39;utf-8&#39;</span>

    <span class="k">def</span> <span class="nf">active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It is used to create a model of target for plugins</span>
<span class="sd">        defining python functions to run on fly.</span>
<span class="sd">        </span>
<span class="sd">        With such an abstraction it is possible to define a AreaVi instance target</span>
<span class="sd">        that python code will act on.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">AreaVi</span><span class="o">.</span><span class="n">ACTIVE</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">chmode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is used to change the AreaVi instance&#39;s mode.</span>
<span class="sd">        It receives one parameter named id which means the</span>
<span class="sd">        mode number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">opt</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>

        <span class="n">MODE_X</span> <span class="o">=</span> <span class="s">&#39;mode</span><span class="si">%s</span><span class="s">-1&#39;</span> <span class="o">%</span> <span class="bp">self</span>
        <span class="n">MODE_Y</span> <span class="o">=</span> <span class="s">&#39;mode</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">opt</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindtags</span><span class="p">((</span><span class="n">MODE_X</span><span class="p">,</span> <span class="n">MODE_Y</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Text&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindtags</span><span class="p">((</span><span class="n">MODE_X</span><span class="p">,</span> <span class="n">MODE_Y</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">add_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It adds a new mode. The opt argument means whether</span>
<span class="sd">        it should propagate the event to the internal text widget callbacks.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt</span>

    <span class="k">def</span> <span class="nf">del_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It performs the opposite of add_mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is used to hook a callback to a sequence</span>
<span class="sd">        specified with its mode. The standard modes are insert and selection.</span>
<span class="sd">        The insert mode prints the key character on the text area.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MODE_Y</span> <span class="o">=</span> <span class="s">&#39;mode</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bind_class</span><span class="p">(</span><span class="n">MODE_Y</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">unhook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It performs the opposite of unhook.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MODE_Y</span> <span class="o">=</span> <span class="s">&#39;mode</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">unbind_class</span><span class="p">(</span><span class="n">MODE_Y</span><span class="p">,</span> <span class="n">seq</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It is like self.hook but accepts</span>
<span class="sd">        a sequence of (id, seq, callback).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hook</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">uninstall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Like self.hook but accepts.</span>
<span class="sd">        (id, seq, callback).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">callback</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unhook</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;end&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">curline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A short hand for.</span>

<span class="sd">        area.get(&#39;insert linestart&#39;, &#39;insert +1l linestart&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1l linestart&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tag_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It removes a given tag from index0 to index1 and re adds</span>
<span class="sd">        the tag to the ranges of text delimited in args.</span>

<span class="sd">        Example:</span>

<span class="sd">        DATA_X = &#39;It is black.\n&#39;</span>
<span class="sd">        DATA_Y = &#39;It is blue.\n&#39;</span>
<span class="sd">        text = Text()</span>
<span class="sd">        text.pack()</span>
<span class="sd">        text.insert(&#39;1.0&#39;, DATA_X)</span>
<span class="sd">        text.insert(&#39;2.0&#39;, DATA_Y)</span>
<span class="sd">        text.tag_add(&#39;X&#39;, &#39;1.0&#39;, &#39;1.0 lineend&#39;)</span>
<span class="sd">        text.tag_add(&#39;Y&#39;, &#39;2.0&#39;, &#39;2.0 lineend&#39;)</span>
<span class="sd">        text.tag_config(&#39;X&#39;, background=&#39;black&#39;)</span>
<span class="sd">        text.tag_config(&#39;Y&#39;, foreground=&#39;blue&#39;)</span>
<span class="sd">        text.tag_update(text, &#39;X&#39;, &#39;1.0&#39;, &#39;end&#39;, (&#39;2.0&#39;, &#39;2.0 lineend&#39;))</span>

<span class="sd">        It removes the X tag from &#39;1.0&#39; to &#39;end&#39; then adds</span>
<span class="sd">        the X tag to the range &#39;2.0&#39; &#39;2.0 lineend&#39;. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">indi</span><span class="p">,</span> <span class="n">indj</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">indi</span><span class="p">,</span> <span class="n">indj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insee</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cmd_like</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="s">&#39;insert lineend&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="s">&#39;insert lineend&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">indref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a short hand function. </span>
<span class="sd">        It is used to convert a Text index</span>
<span class="sd">        into two integers.</span>

<span class="sd">        Ex:</span>

<span class="sd">        a, b = area.indref(&#39;insert&#39;)</span>

<span class="sd">        Now, a and b can be manipulated</span>
<span class="sd">        as numbers.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setcur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It is used to set the cursor position at</span>
<span class="sd">        a given index using line and col.</span>

<span class="sd">        line is a number which represents</span>
<span class="sd">        a given line index in the AreaVi instance.</span>
<span class="sd">    </span>
<span class="sd">        col is a column.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setcurl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set cursor line.</span>
<span class="sd">        It is used to set the cursor position at a given</span>
<span class="sd">        line. It sets the cursor at line.0 position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&#39;0&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">indint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        This method is used</span>
<span class="sd">        when i can&#39;t use self.indref.</span>

<span class="sd">        It seems self.indref returns </span>

<span class="sd">        2.10 when the input is 2.34</span>

<span class="sd">        it happens when the index col</span>
<span class="sd">        is longer than the actual line col.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">indcol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is a short hand method for getting</span>
<span class="sd">        the last col in which the cursor was in.</span>

<span class="sd">        It is useful when implementing functions to</span>
<span class="sd">        select pieces of text.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_col</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setcol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It sets the mark used by the arrows</span>
<span class="sd">        keys and selection state.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_col</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">indcur</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns the actual line, col for the</span>
<span class="sd">        cursor position. So, the values can be</span>
<span class="sd">        manipulated with integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indref</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">seecur</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Just a shorthand for area.see(&#39;insert&#39;)</span>
<span class="sd">        which makes the cursor visible wherever it is in.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">inset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Just a shorthand for area.mark_set(&#39;insert&#39;, index)</span>
<span class="sd">        so we spare some typing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">is_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns True if the cursor is positioned</span>
<span class="sd">        at the end of the AreaVi instance.</span>
<span class="sd">        </span>
<span class="sd">        This is useful when implementing other methods.</span>
<span class="sd">        Like those from visual block selection to avoid</span>
<span class="sd">        the cursor jumping to odd places when it achieves</span>
<span class="sd">        the end of the text region.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># I have to use &#39;end -1l linestart&#39; since it seems the &#39;end&#39; tag</span>
        <span class="c"># corresponds to a one line after the last visible line.</span>
        <span class="c"># So last line lineend != &#39;end&#39;.</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="s">&#39;!=&#39;</span><span class="p">,</span> <span class="s">&#39;end -1l linestart&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function returns True if the cursor is</span>
<span class="sd">        at the start of the text region. It is on index &#39;1.0&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="s">&#39;!=&#39;</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        It sets the cursor position one line down.  </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_end</span><span class="p">():</span>
        <span class="c"># We first check if it is at the end</span>
        <span class="c"># so we avoid the cursor jumping at odd positions.</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcol</span><span class="p">()</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcur</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setcur</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>        
        
    <span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>   
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        It sets the cursor one line up.  </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_start</span><span class="p">():</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcol</span><span class="p">()</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcur</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setcur</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        It moves the cursor one character left.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert -1c&#39;</span><span class="p">)</span>

        <span class="c"># The mark used by self.down, self.up.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_col</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        It moves the cursor one character right.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1c&#39;</span><span class="p">)</span>

        <span class="c"># The mark used by self.down, self.up.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_col</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">start_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        It sets the mark sel_start to the insert position.</span>

<span class="sd">        So, when sel_up, sel_down, sel_right, sel_left are</span>
<span class="sd">        called then they will select a region from this mark.  </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">start_block_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;_block_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">is_add_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It checks whether the selection must be</span>
<span class="sd">        removed or added.</span>
<span class="sd">        </span>
<span class="sd">        If it returns True then the selection must be</span>
<span class="sd">        removed. True means that the &#39;_sel_start_&#39;</span>
<span class="sd">        mark is positioned above the cursor position.</span>
<span class="sd">        So, it must remove the selection instead of</span>
<span class="sd">        adding it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> linestart&#39;</span> <span class="o">%</span> <span class="n">index</span><span class="p">,</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s">&#39;insert linestart&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rmsel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is a short hand for area.tag_remove(&#39;sel&#39;, index0, index1)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
        <span class="n">index3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="n">index2</span><span class="p">,</span> <span class="n">index3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addsel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It adds &#39;sel&#39; to the range (AreaVi.min(index0, index1), </span>
<span class="sd">                                    AreaVi.max(index0, index1))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
        <span class="n">index3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="n">index2</span><span class="p">,</span> <span class="n">index3</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns the min between index0 and index1.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="n">index1</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">index0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">index1</span>

    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns the max between index0 and index1.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="n">index1</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">index1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">index0</span>

    <span class="k">def</span> <span class="nf">sel_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It adds &#39;sel&#39; one line up the &#39;insert&#39; position</span>
<span class="sd">        and sets the cursor one line up.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rmsel</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span><span class="p">()</span>

        <span class="n">index0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addsel</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_add_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns True if the cursor is positioned below</span>
<span class="sd">        the initial mark for selection. </span>

<span class="sd">        It determins if the selection must be removed or added when</span>
<span class="sd">        sel_down is called.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> linestart&#39;</span> <span class="o">%</span> <span class="n">index</span><span class="p">,</span> <span class="s">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s">&#39;insert linestart&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sel_down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        It adds or removes selection one line down. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rmsel</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span><span class="p">()</span>

        <span class="n">index0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addsel</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
    

    <span class="k">def</span> <span class="nf">is_add_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns True if the cursor is positioned at the left</span>
<span class="sd">        of the initial selection mark. It is useful for sel_right method.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sel_right</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        It adds or removes selection one character right.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rmsel</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">()</span>

        <span class="n">index0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addsel</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
    

    <span class="k">def</span> <span class="nf">is_add_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns True if the cursor is positioned at the right of</span>
<span class="sd">        the initial mark selection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sel_left</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        It adds or removes selection one character left.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rmsel</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">()</span>

        <span class="n">index0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addsel</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">indmsel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It is just a shorthand for getting the last selection mark.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indref</span><span class="p">(</span><span class="s">&#39;_sel_start_&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addblock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It adds block selection from index0 to index1.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
        <span class="n">index3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indint</span><span class="p">(</span><span class="n">index2</span><span class="p">)</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">d</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indint</span><span class="p">(</span><span class="n">index3</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addsel</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">rmblock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It removes block selection from index0 to index1.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
        <span class="n">index3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indint</span><span class="p">(</span><span class="n">index2</span><span class="p">)</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">d</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indint</span><span class="p">(</span><span class="n">index3</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rmsel</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span>  <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">block_down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        It adds or removes block selection one line down.  </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcol</span><span class="p">()</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">d</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcur</span><span class="p">()</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;_block_sel_start_&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmblock</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span><span class="p">()</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcol</span><span class="p">()</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcur</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addblock</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">block_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        It adds or removes block selection one line up.  </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcol</span><span class="p">()</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">d</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcur</span><span class="p">()</span>
        <span class="n">index</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;_block_sel_start_&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rmblock</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span><span class="p">()</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcol</span><span class="p">()</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcur</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addblock</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">is_line_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns True if the cursor is at the start of the cursor line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;!=&#39;</span><span class="p">,</span> <span class="s">&#39;insert linestart&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">block_left</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It adds block selection to the left.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcol</span><span class="p">()</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">d</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcur</span><span class="p">()</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;_block_sel_start_&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmblock</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">()</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcol</span><span class="p">()</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcur</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addblock</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">is_line_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns True if the cursor is at the end of the cursor line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;!=&#39;</span><span class="p">,</span> <span class="s">&#39;insert lineend&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">block_right</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It adds a block selection to the right.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcol</span><span class="p">()</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">d</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcur</span><span class="p">()</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;_block_sel_start_&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rmblock</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">()</span>

        <span class="n">a</span><span class="p">,</span> <span class="n">b</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcol</span><span class="p">()</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indcur</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addblock</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

                
    <span class="k">def</span> <span class="nf">clear_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It removes &#39;sel&#39; tag from all ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="s">&#39;sel.first&#39;</span><span class="p">,</span> <span class="s">&#39;sel.last&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">select_char</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        it adds &#39;sel&#39; a char ahead the cursor position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addsel</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1c&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">unselect_char</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It removes &#39;sel&#39; a char from the cursor position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rmsel</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1c&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clchar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It deletes a char from the cursor position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1c&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">do_undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It does undo.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edit_undo</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">TclError</span><span class="p">:</span>
            <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">do_redo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It redoes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edit_redo</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">TclError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">sel_text_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It selects all text from insert position to the start position</span>
<span class="sd">        of the text.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">go_text_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addsel</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sel_text_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It selects all text form the insert position to the end of the text.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">go_text_end</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addsel</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">go_text_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It goes to the first position in the text.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">go_text_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It goes to the end of the text.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;end linestart&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">sel_line_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It adds selection from the insert position to the </span>
<span class="sd">        start of the line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">go_line_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addsel</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sel_line_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It selects all text from insert position to the end of the line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">go_line_end</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addsel</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">go_line_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It goes to the beginning of the cursor position line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert linestart&#39;</span><span class="p">)</span>
        

    <span class="k">def</span> <span class="nf">go_line_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It goes to the end of the cursor position line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert lineend&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">go_next_word</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It puts the cursor on the beginning of the next word.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">IntVar</span><span class="p">()</span>
        <span class="c"># It seems that regexp doesnt match ^ as starting of the line when nolinestop=True</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39; [^ ]|^[^ ]&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1c&#39;</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span> <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">go_prev_word</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It puts the cursor in the beginning of the previous word.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">IntVar</span><span class="p">()</span>
        <span class="c"># It seems that regexp doesnt match ^ as starting of the line when nolinestop=True</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39; [^ ]|^[^ ]&#39;</span><span class="p">,</span> <span class="s">&#39;insert -1c&#39;</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">backwards</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span> <span class="k">return</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">go_next_sym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chars</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">,</span> <span class="s">&#39;{&#39;</span><span class="p">,</span> <span class="s">&#39;}&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="s">&#39;;&#39;</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It puts the cursor on the next occurency of:</span>
<span class="sd">        (&#39;(&#39;, &#39;)&#39;, &#39;.&#39;, &#39;[&#39;, &#39;]&#39;, &#39;{&#39;, &#39;}&#39;, &#39;,&#39;, &#39;:&#39;, &#39;;&#39;, &#39;&quot;&#39;, &quot;&#39;&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">chars</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ind</span><span class="p">:</span> <span class="s">&#39;\</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ind</span><span class="p">,</span> <span class="n">chars</span><span class="p">)</span>
        <span class="n">REG</span>   <span class="o">=</span> <span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">REG</span><span class="p">,</span> <span class="s">&#39;insert +1c&#39;</span><span class="p">,</span> <span class="s">&#39;end&#39;</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span> <span class="k">return</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">go_prev_sym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chars</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">,</span> <span class="s">&#39;{&#39;</span><span class="p">,</span> <span class="s">&#39;}&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="s">&#39;;&#39;</span><span class="p">,</span> <span class="s">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It puts the cursor on the previous occurency of:</span>
<span class="sd">        (&#39;(&#39;, &#39;)&#39;, &#39;.&#39;, &#39;[&#39;, &#39;]&#39;, &#39;{&#39;, &#39;}&#39;, &#39;,&#39;, &#39;:&#39;, &#39;;&#39;, &#39;&quot;&#39;, &quot;&#39;&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">ind</span><span class="p">:</span> <span class="s">&#39;\</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ind</span><span class="p">,</span> <span class="n">chars</span><span class="p">)</span>
        <span class="n">REG</span>   <span class="o">=</span> <span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">REG</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">backwards</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span> <span class="k">return</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="nf">cllin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It deletes the cursor position line, makes the cursor visible</span>
<span class="sd">        and adds a separator to the undo stack.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1l linestart&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
    

    <span class="k">def</span> <span class="nf">cpsel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It copies to the clip board ranges of text</span>
<span class="sd">        that are selected and removes the selection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_get_ranges</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard_append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="s">&#39;sel.first&#39;</span><span class="p">,</span> <span class="s">&#39;sel.last&#39;</span><span class="p">)</span>
    

    <span class="k">def</span> <span class="nf">cpblock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It copies blocks of text that are selected</span>
<span class="sd">        with a separator &#39;\n&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_get_ranges</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard_append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="s">&#39;sel.first&#39;</span><span class="p">,</span> <span class="s">&#39;sel.last&#39;</span><span class="p">)</span>
    

    <span class="k">def</span> <span class="nf">ctblock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It cuts blocks of text with a separator &#39;\n&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_get_ranges</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard_append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_delete_ranges</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">)</span>
    

    <span class="k">def</span> <span class="nf">ctsel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It cuts the selected text.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_get_ranges</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard_append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_delete_ranges</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">clsel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It deletes all selected text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_delete_ranges</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">)</span>
    

    <span class="k">def</span> <span class="nf">ptsel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It pastes over the cursor position data from the clipboard </span>
<span class="sd">        and adds a separator.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clipboard_get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    

    <span class="k">def</span> <span class="nf">ptsel_after</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It pastes one line after the cursor position data from clipboard</span>
<span class="sd">        and adds a separator.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clipboard_get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;insert +1l linestart&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">ptsel_before</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It pastes data from the cursor position one line before the cursor</span>
<span class="sd">        position and adds a separator.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clipboard_get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">select_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It adds selection to the cursor position line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1l linestart&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unselect_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It removes selection from the cursor position line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tag_remove</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1l linestart&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">toggle_line_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_contains</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1l linestart&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">map</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unselect_line</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">select_line</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">select_word</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It selects a word from the cursor position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="n">backwards</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">index2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="s">&#39;insert lineend&#39;</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="s">&#39;insert linestart&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">index1</span> <span class="k">else</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +1c&#39;</span> <span class="o">%</span> <span class="n">index1</span><span class="p">,</span> 
                     <span class="s">&#39;insert lineend&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">index2</span> <span class="k">else</span> <span class="n">index2</span><span class="p">)</span>
    

    <span class="k">def</span> <span class="nf">scroll_line_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It scrolls one line up</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="n">SCROLL</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;units&#39;</span><span class="p">)</span>
        <span class="n">is_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlineinfo</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_visible</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert -1l&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">scroll_line_down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It scrolls one line down.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="n">SCROLL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;units&#39;</span><span class="p">)</span>
        <span class="n">is_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlineinfo</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_visible</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1l&#39;</span><span class="p">)</span>
    

    <span class="k">def</span> <span class="nf">scroll_page_down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It goes one page down.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="n">SCROLL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;page&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;@0,0&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">scroll_page_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It goes one page up.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yview</span><span class="p">(</span><span class="n">SCROLL</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;page&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;@0,0&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">insert_line_down</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It inserts one line down from the cursor position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;insert +1l linestart&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1l linestart&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">select_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It selects all text.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="s">&#39;end&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert_line_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It inserts one line up.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;insert linestart&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert -1l linestart&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">shift_sel_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">srow</span><span class="p">,</span> <span class="n">scol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indref</span><span class="p">(</span><span class="s">&#39;sel.first&#39;</span><span class="p">)</span>
        <span class="n">erow</span><span class="p">,</span> <span class="n">ecol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indref</span><span class="p">(</span><span class="s">&#39;sel.last&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_right</span><span class="p">(</span><span class="n">srow</span><span class="p">,</span> <span class="n">erow</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">shift_sel_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">srow</span><span class="p">,</span> <span class="n">scol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indref</span><span class="p">(</span><span class="s">&#39;sel.first&#39;</span><span class="p">)</span>
        <span class="n">erow</span><span class="p">,</span> <span class="n">ecol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indref</span><span class="p">(</span><span class="s">&#39;sel.last&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_left</span><span class="p">(</span><span class="n">srow</span><span class="p">,</span> <span class="n">erow</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">shift_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srow</span><span class="p">,</span> <span class="n">erow</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a start row and a end row it shifts</span>
<span class="sd">        a block of text to the right.</span>
<span class="sd">        </span>
<span class="sd">        This is specially useful when working with</span>
<span class="sd">        source code files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">srow</span><span class="p">,</span> <span class="n">erow</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.0&#39;</span> <span class="o">%</span> <span class="n">ind</span><span class="p">,</span> <span class="n">width</span> <span class="o">*</span> <span class="n">char</span><span class="p">)</span> 
    

    <span class="k">def</span> <span class="nf">shift_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">srow</span><span class="p">,</span> <span class="n">erow</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a start row and a end row it shifts</span>
<span class="sd">        a block of text to the left.</span>


<span class="sd">        This is specially useful when working with</span>
<span class="sd">        source code files.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">edit_separator</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">srow</span><span class="p">,</span> <span class="n">erow</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.0&#39;</span> <span class="o">%</span> <span class="n">ind</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span> 
    

    <span class="k">def</span> <span class="nf">tag_find_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns an interator corresponding to calling AreaVi.find</span>
<span class="sd">        between the ranges of the tag specified by name.</span>

<span class="sd">        You shouldn&#39;t delete or insert data while performing this operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># It should be built on top of nextrange.</span>
        <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_ranges</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">indi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="nb">map</span><span class="p">[</span><span class="n">indi</span><span class="p">],</span> <span class="nb">map</span><span class="p">[</span><span class="n">indi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">indj</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span> 
                <span class="k">yield</span> <span class="n">indj</span>

    <span class="k">def</span> <span class="nf">tag_replace_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="s">&#39;end&#39;</span><span class="p">,</span> 
                           <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It replaces all occurrences of regex inside a tag ranges</span>
<span class="sd">        for data.</span>

<span class="sd">        name     - Name of the tag.</span>
<span class="sd">        regex    - The pattern.</span>
<span class="sd">        data     - The data to replace.</span>
<span class="sd">        args     - Arguments given to AreaVi.find.</span>
<span class="sd">        **kwargs - A dictionary of arguments given to AreaVi.find.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_nextrange</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">stopindex</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">map</span><span class="p">:</span> <span class="k">break</span>

            <span class="n">index3</span><span class="p">,</span> <span class="n">index4</span> <span class="o">=</span> <span class="nb">map</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">index4</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">replace_all</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">index3</span><span class="p">,</span> <span class="n">index4</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tag_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theme</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Just a short hand for</span>

<span class="sd">        theme = {&#39;tag_name&#39;: {&#39;background&#39;: &#39;blue&#39;}</span>

<span class="sd">        for name, kwargs in theme.iteritems():</span>
<span class="sd">            self.tag_config(name, **kwargs)</span>
<span class="sd">            self.tag_lower(name)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="n">theme</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag_config</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag_lower</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">tag_add_found</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">map</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;</span>
<span class="sd">        It adds a tag to the match ranges from either AreaVi.find or</span>
<span class="sd">        AreaVi.tag_find_ranges.</span>
<span class="sd">    </span>
<span class="sd">        name - The tag to be added.</span>
<span class="sd">        map  - An iterator from AreaVi.find or AreaVi.tag_find_ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">split_with_cond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It determines which chunks should be yielded based on cond.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">chk</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cond</span><span class="p">(</span><span class="n">chk</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">:</span> <span class="k">yield</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It splits the contents of the text widget into chunks based on a regex.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index0</span> <span class="o">=</span> <span class="s">&#39;1.0&#39;</span>
        <span class="k">for</span> <span class="n">chk</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">index2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">index0</span><span class="p">):</span> 
                <span class="k">yield</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">),</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
            
            <span class="k">yield</span><span class="p">(</span><span class="n">chk</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">)</span>
            <span class="n">index0</span> <span class="o">=</span> <span class="n">index2</span>
    

    <span class="k">def</span> <span class="nf">find_with_cond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It determines which matches should be yielded.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">chk</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cond</span><span class="p">(</span><span class="n">chk</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">yield</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">find_one_by_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="s">&#39;end&#39;</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nocase</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
             <span class="n">elide</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">IntVar</span><span class="p">()</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">stopindex</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exact</span><span class="p">,</span> <span class="n">nocase</span><span class="o">=</span><span class="n">nocase</span><span class="p">,</span> 
                                <span class="n">nolinestop</span><span class="o">=</span><span class="n">nolinestop</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="n">regexp</span><span class="p">,</span> <span class="n">elide</span><span class="o">=</span><span class="n">elide</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="nb">len</span>   <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">tmp</span>   <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>

            <span class="n">pos0</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">pos1</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">len</span><span class="p">))</span>
            <span class="n">index</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +1l&#39;</span> <span class="o">%</span> <span class="n">pos0</span>
            <span class="k">yield</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">pos0</span><span class="p">,</span> <span class="n">pos1</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="s">&#39;end&#39;</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nocase</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
             <span class="n">elide</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns an iterator of matches. It is based on the Text.search method</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">IntVar</span><span class="p">()</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">stopindex</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exact</span><span class="p">,</span> <span class="n">nocase</span><span class="o">=</span><span class="n">nocase</span><span class="p">,</span> 
                                <span class="n">nolinestop</span><span class="o">=</span><span class="n">nolinestop</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="n">regexp</span><span class="p">,</span> <span class="n">elide</span><span class="o">=</span><span class="n">elide</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="nb">len</span>   <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">tmp</span>   <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">len</span><span class="p">)</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>

            <span class="n">pos0</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">pos1</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">len</span><span class="p">))</span>
            <span class="n">index</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +1c&#39;</span> <span class="o">%</span> <span class="n">tmp</span>
            <span class="k">yield</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">pos0</span><span class="p">,</span> <span class="n">pos1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">forwards</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">backwards</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nocase</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">count</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">elide</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
            
        <span class="sd">&#39;&#39;&#39;Standard search method, but with support for the nolinestop</span>
<span class="sd">        option which is new in tk 8.5 but not supported by tkinter out</span>
<span class="sd">        of the box.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_w</span><span class="p">,</span> <span class="s">&#39;search&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">forwards</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-forwards&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">backwards</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-backwards&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exact</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-exact&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">regexp</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-regexp&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nocase</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-nocase&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">elide</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-elide&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nolinestop</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;-nolinestop&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">count</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;-count&#39;</span><span class="p">);</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="ow">and</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stopindex</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stopindex</span><span class="p">)</span>
    
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tk</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span>


    <span class="k">def</span> <span class="nf">pick_next_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">index0</span><span class="o">=</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                        <span class="n">nocase</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">elide</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the next match with regex up the cursor.</span>
<span class="sd">        It sets the cursor at the index of the occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">IntVar</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="n">stopindex</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="n">regexp</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exact</span><span class="p">,</span> 
                            <span class="n">nocase</span><span class="o">=</span><span class="n">nocase</span><span class="p">,</span> <span class="n">elide</span><span class="o">=</span><span class="n">elide</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="n">nolinestop</span><span class="p">,</span> <span class="n">backwards</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">index1</span>

    <span class="k">def</span> <span class="nf">pick_next_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">index0</span><span class="o">=</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="s">&#39;end&#39;</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                       <span class="n">nocase</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">elide</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the next match with regex down.</span>
<span class="sd">        It sets the cursor at the index of the occurrence.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">IntVar</span><span class="p">()</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="n">stopindex</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="n">regexp</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exact</span><span class="p">,</span> <span class="n">nocase</span><span class="o">=</span><span class="n">nocase</span><span class="p">,</span> 
                            <span class="n">elide</span><span class="o">=</span><span class="n">elide</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="n">nolinestop</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span> <span class="k">return</span>

        <span class="n">index1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">see</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">index1</span>

    <span class="k">def</span> <span class="nf">replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">forwards</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">backwards</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nocase</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">elide</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It is used to replace occurrences of a given match.</span>

<span class="sd">        It is possible to use a callback function to return what is replaced </span>
<span class="sd">        as well.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">IntVar</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">stopindex</span><span class="p">,</span> <span class="n">forwards</span><span class="o">=</span><span class="n">forwards</span><span class="p">,</span> <span class="n">backwards</span><span class="o">=</span><span class="n">backwards</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exact</span><span class="p">,</span> <span class="n">nocase</span><span class="o">=</span><span class="n">nocase</span><span class="p">,</span> 
                            <span class="n">nolinestop</span><span class="o">=</span><span class="n">nolinestop</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="n">regexp</span><span class="p">,</span> <span class="n">elide</span><span class="o">=</span><span class="n">elide</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>

            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span> <span class="k">return</span>

        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">data</span><span class="p">):</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">())))</span>

        <span class="n">index0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">count</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">index0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">replace_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">stopindex</span><span class="o">=</span><span class="s">&#39;end&#39;</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nocase</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> 
             <span class="n">elide</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">nolinestop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It is used to replace all occurrences of a given match in a range.</span>
<span class="sd">        It accepts a callback function that determines what is replaced.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># It is needed because the range will grow</span>
        <span class="c"># when data is inserted, the intent is searching</span>
        <span class="c"># over a pre defined range.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STOP_REPLACE_INDEX</span><span class="p">,</span> <span class="n">stopindex</span><span class="p">)</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">STOP_REPLACE_INDEX</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exact</span><span class="p">,</span> <span class="n">nocase</span><span class="o">=</span><span class="n">nocase</span><span class="p">,</span> 
                               <span class="n">nolinestop</span><span class="o">=</span><span class="n">nolinestop</span><span class="p">,</span> <span class="n">regexp</span><span class="o">=</span><span class="n">regexp</span><span class="p">,</span> <span class="n">elide</span><span class="o">=</span><span class="n">elide</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">map</span><span class="p">:</span> <span class="k">return</span>

            <span class="n">index</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="nb">map</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> +</span><span class="si">%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_paren_search_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">char</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1c&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="n">start</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get_paren_search_sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">char</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;insert +1c&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="n">start</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;+&#39;</span>
        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;-&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">select_case_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pair</span><span class="p">,</span> <span class="n">MAX</span><span class="o">=</span><span class="mi">1500</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">case_pair</span><span class="p">(</span><span class="n">MAX</span><span class="p">,</span> <span class="o">*</span><span class="n">pair</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span> <span class="k">return</span>
    
        <span class="nb">min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="s">&#39;==&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">):</span> <span class="nb">min</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +1c&#39;</span> <span class="o">%</span> <span class="nb">min</span>
    
        <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="s">&#39;==&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">):</span> <span class="nb">min</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +1c&#39;</span> <span class="o">%</span> <span class="nb">min</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_add</span><span class="p">(</span><span class="s">&#39;sel&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">case_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;)&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Once this method is called, it returns an index for the next</span>
<span class="sd">        matching parenthesis or None if the char over the cursor</span>
<span class="sd">        isn&#39;t either &#39;(&#39; or &#39;)&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_paren_search_dir</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

        <span class="c"># If dir is None then there is no match.</span>
        <span class="k">if</span> <span class="nb">dir</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#39;&#39;</span>

        <span class="n">REG</span>   <span class="o">=</span> <span class="s">&#39;\</span><span class="si">%s</span><span class="s">|\</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="n">sign</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_paren_search_sign</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># If we are searching fowards we don&#39;t need</span>
        <span class="c"># to add 1c.</span>

        <span class="n">index</span> <span class="o">=</span> <span class="s">&#39;insert </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;+1c&#39;</span> <span class="k">if</span> <span class="nb">dir</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">size</span>  <span class="o">=</span> <span class="n">IntVar</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">REG</span><span class="p">,</span> <span class="n">index</span>     <span class="o">=</span> <span class="n">index</span><span class="p">,</span>
                                     <span class="n">stopindex</span> <span class="o">=</span> <span class="s">&#39;insert </span><span class="si">%s%s</span><span class="s">c&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="nb">max</span><span class="p">),</span>
                                     <span class="n">count</span>     <span class="o">=</span> <span class="n">size</span><span class="p">,</span> 
                                     <span class="n">backwards</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">,</span> 
                                     <span class="n">regexp</span>    <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> 

            <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#39;&#39;</span>

            <span class="n">char</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +1c&#39;</span> <span class="o">%</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="n">start</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">count</span><span class="p">:</span> 
                <span class="k">return</span> <span class="n">index</span>

            <span class="c"># When we are searching backwards we don&#39;t need</span>
            <span class="c"># to set a character back because index will point</span>
            <span class="c"># to the start of the match.</span>
            <span class="n">index</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;+1c&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">dir</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                

    <span class="k">def</span> <span class="nf">clear_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It clears all text inside an AreaVi instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">os</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="s">&#39;end&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s">&#39;&lt;&lt;ClearData&gt;&gt;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It dumps all text from a file into an AreaVi instance.</span>
<span class="sd">        </span>
<span class="sd">        filename - Name of the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">os</span>
        <span class="n">filename</span>      <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">fd</span>            <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">data</span>          <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># i could generate a tk event here.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charset</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="s">&#39;end&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s">&#39;&lt;&lt;LoadData&gt;&gt;&#39;</span><span class="p">)</span>
        <span class="nb">type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s">&#39;&lt;&lt;Load-</span><span class="si">%s</span><span class="s">&gt;&gt;&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It saves the actual text content in the current file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="s">&#39;end&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charset</span><span class="p">)</span>
        <span class="n">fd</span>   <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s">&#39;&lt;&lt;SaveData&gt;&gt;&#39;</span><span class="p">)</span>

        <span class="nb">type</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_generate</span><span class="p">(</span><span class="s">&#39;&lt;&lt;Save-</span><span class="si">%s</span><span class="s">&gt;&gt;&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_data_as</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It saves the content of the given AreaVi instance into</span>
<span class="sd">        a file whose name is specified in filename.</span>


<span class="sd">        filename - Name of the file to save the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">tag_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns True if there is a tag range for</span>
<span class="sd">        a tag name which contains index0 and index1.</span>
<span class="sd">    </span>
<span class="sd">        The algorithm consists of:</span>
<span class="sd">    </span>
<span class="sd">        It calls text.tag_ranges(name)</span>
<span class="sd">        which returns a list of indexs</span>
<span class="sd">        that the tag is attached to.</span>
<span class="sd">      </span>
<span class="sd">    </span>
<span class="sd">        Then it goes through the list of indexs</span>
<span class="sd">        checking which of the indexes contains index0 and index1.</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span> 

        <span class="n">ls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_ranges</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">index2</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">string</span>
            <span class="n">index3</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">string</span>
            <span class="n">r1</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">index2</span><span class="p">,</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="n">index0</span><span class="p">)</span>
            <span class="n">r2</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">index3</span><span class="p">,</span> <span class="s">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">r1</span> <span class="ow">and</span> <span class="n">r2</span><span class="p">:</span> <span class="k">return</span> <span class="n">index2</span><span class="p">,</span> <span class="n">index3</span>

        <span class="k">return</span> <span class="p">()</span>


    <span class="k">def</span> <span class="nf">tag_sub_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">index0</span><span class="o">=</span><span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="n">index1</span><span class="o">=</span><span class="s">&#39;end&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It replaces ranges of text delimited by tag between index0</span>
<span class="sd">        and index1 for data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_nextrange</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">map</span><span class="p">:</span> <span class="k">break</span>

            <span class="n">index3</span><span class="p">,</span> <span class="n">index4</span> <span class="o">=</span> <span class="nb">map</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">index3</span><span class="p">,</span> <span class="n">index4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index3</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">tag_delete_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It deletes ranges of text that are mapped to tag name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tag_sub_ranges</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tag_get_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;     </span>
<span class="sd">        It should be built from get_slices_data </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_get_data</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">sep</span>
        <span class="k">return</span> <span class="n">data</span>


    <span class="k">def</span> <span class="nf">tag_get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It returns an iterator with the text inside tag name.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_ranges</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">map</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="nb">map</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">yield</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">mark_set_next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">mark</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">next_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_nextrange</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +1c&#39;</span> <span class="o">%</span> <span class="n">mark</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">next_tag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="n">mark</span><span class="p">,</span> <span class="n">next_tag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">mark_set_prev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">mark</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">prev_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_prevrange</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">mark</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prev_tag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mark_set</span><span class="p">(</span><span class="n">mark</span><span class="p">,</span> <span class="n">prev_tag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">tag_prev_occur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag_names</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">tag_names</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_prevrange</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pos</span><span class="p">:</span> <span class="k">return</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">default</span>
    
    <span class="k">def</span> <span class="nf">tag_next_occur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag_names</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">tag_names</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_nextrange</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">index0</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pos</span><span class="p">:</span> <span class="k">return</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">default</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_all_areavi_instances</span><span class="p">(</span><span class="n">wid</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">wid</span><span class="o">.</span><span class="n">winfo_children</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">AreaVi</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">ind</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">AreaVi</span><span class="o">.</span><span class="n">get_all_areavi_instances</span><span class="p">(</span><span class="n">ind</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">ind</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_opened_files</span><span class="p">(</span><span class="n">wid</span><span class="p">):</span>
        <span class="nb">map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">AreaVi</span><span class="o">.</span><span class="n">get_all_areavi_instances</span><span class="p">(</span><span class="n">wid</span><span class="p">):</span>
            <span class="nb">map</span><span class="p">[</span><span class="n">ind</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">ind</span>
        <span class="k">return</span> <span class="nb">map</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">find_on_all</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">indi</span> <span class="ow">in</span> <span class="n">AreaVi</span><span class="o">.</span><span class="n">get_all_areavi_instances</span><span class="p">(</span><span class="n">wid</span><span class="p">):</span>
            <span class="n">it</span> <span class="o">=</span> <span class="n">indi</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">,</span> <span class="s">&#39;end&#39;</span><span class="p">)</span>
    
            <span class="k">for</span> <span class="n">indj</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">indi</span><span class="p">,</span> <span class="n">indj</span>
    
    <span class="k">def</span> <span class="nf">get_cursor_word</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="s">&#39;insert&#39;</span><span class="p">,</span> <span class="s">&#39;==&#39;</span><span class="p">,</span> <span class="s">&#39;insert linestart&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;&#39;</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">,</span> 
                                      <span class="n">stopindex</span><span class="o">=</span><span class="s">&#39;insert linestart&#39;</span><span class="p">,</span><span class="n">regexp</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                                      <span class="n">backwards</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span> <span class="n">index</span> <span class="o">=</span> <span class="s">&#39;insert linestart&#39;</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">index</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> +1c&#39;</span> <span class="o">%</span> <span class="n">index</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;==&#39;</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="s">&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">index</span>
    
    <span class="k">def</span> <span class="nf">match_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wid</span><span class="p">,</span> <span class="n">delim</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cursor_word</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">area</span><span class="p">,</span> <span class="p">(</span><span class="n">chk</span><span class="p">,</span> <span class="n">pos0</span><span class="p">,</span> <span class="n">pos1</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_on_all</span><span class="p">(</span><span class="n">wid</span><span class="p">,</span> <span class="s">&#39;[^ ]*</span><span class="si">%s</span><span class="s">[^ ]+&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">chk</span><span class="p">,</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">complete_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wid</span><span class="p">):</span>
        <span class="n">seq</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_word</span><span class="p">(</span><span class="n">wid</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
                <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s">&#39;insert&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">yield</span>
</pre></div>
</body>
</html>
